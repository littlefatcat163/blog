<!DOCTYPE html><html lang="en" data-default-color-scheme="dark"><head><link rel="stylesheet" href="/blog/css/custom.css"><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/blog/img/docs.png"><link rel="icon" href="/blog/img/docs.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"><meta name="theme-color" content="#000"><meta name="author" content="littlefatcat"><meta name="keywords" content=""><meta name="description" content="函数作为参数传递和返回值输出"><meta property="og:type" content="article"><meta property="og:title" content="高阶函数"><meta property="og:url" content="https://littlefatcat163.github.io/blog/2023/05/08/js/hight-func/index.html"><meta property="og:site_name" content="Blog"><meta property="og:description" content="函数作为参数传递和返回值输出"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://littlefatcat163.github.io/blog/img/js.webp"><meta property="article:published_time" content="2023-05-08T12:18:51.000Z"><meta property="article:modified_time" content="2024-03-16T03:27:44.148Z"><meta property="article:author" content="littlefatcat"><meta property="article:tag" content="javascript"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://littlefatcat163.github.io/blog/img/js.webp"><meta name="description" content="函数作为参数传递和返回值输出"><meta name="referrer" content="no-referrer-when-downgrade"><meta http-equiv="Cache-Control" content="no-cache,no-store,must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><title>高阶函数 - Blog</title><link rel="stylesheet" href="//cdn.staticfile.net/bootstrap/5.3.2/css/bootstrap.min.css"><link rel="stylesheet" href="/blog/css/main.css"><link id="highlight-css" rel="stylesheet" href="//lib.baomitu.com/highlight.js/11.9.0/styles/qtcreator-light.min.css"><link id="highlight-css-dark" rel="stylesheet" href="//lib.baomitu.com/highlight.js/11.9.0/styles/qtcreator-dark.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><script id="lnote-configs">var LNote=window.LNote||{version:"1.2.8",root:"/blog/"}</script><script src="/blog/js/utils.js"></script><script src="/blog/js/color-schema.js"></script><meta name="generator" content="Hexo 7.1.1"></head><body><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none;overflow:hidden;width:0;height:0"><defs><symbol id="success" viewBox="0 0 16 16" fill="currentColor"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/></symbol><symbol id="info" viewBox="0 0 16 16" fill="currentColor"><path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/></symbol><symbol id="warning" viewBox="0 0 16 16" fill="currentColor"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 4a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0l.35-3.507A.905.905 0 0 0 8 4zm.002 6a1 1 0 1 0 0 2 1 1 0 0 0 0-2z"/></symbol><symbol id="danger" viewBox="0 0 16 16" fill="currentColor"><path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/></symbol><symbol id="tap-link" viewBox="0 0 16 16" fill="currentColor"><path d="M11.53,7.28h2.72a1.75,1.75,0,0,0,0-3.5H8.91l-.24-1.2A1.49,1.49,0,0,0,7,1.39l-3.1.34a2.34,2.34,0,0,0-1.11.41L.67,3.57A1.5,1.5,0,0,0,0,4.82V11.2a1.48,1.48,0,0,0,.76,1.3L3.2,13.9a3.54,3.54,0,0,0,1.39.44l2.71.27a2,2,0,0,0,2.19-1.79,1.27,1.27,0,0,0,0-.2V12l.25-.19a2.36,2.36,0,0,0,.71-.88,2.63,2.63,0,0,0,.11-1.16V9.68a1.3,1.3,0,0,0,.64-.56,2.78,2.78,0,0,0,.29-.74,5.28,5.28,0,0,0,0-1.05Z" transform="translate(0 -1.38)"/></symbol><symbol id="plus-circle-fill" viewBox="0 0 16 16" fill="currentColor"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8.5 4.5a.5.5 0 0 0-1 0v3h-3a.5.5 0 0 0 0 1h3v3a.5.5 0 0 0 1 0v-3h3a.5.5 0 0 0 0-1h-3v-3z"/></symbol><symbol id="dash-circle-fill" viewBox="0 0 16 16" fill="currentColor"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM4.5 7.5a.5.5 0 0 0 0 1h7a.5.5 0 0 0 0-1h-7z"/></symbol><symbol id="x" viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></symbol><symbol id="check" viewBox="0 0 16 16" fill="currentColor"><path d="M10.97 4.97a.75.75 0 0 1 1.07 1.05l-3.99 4.99a.75.75 0 0 1-1.08.02L4.324 8.384a.75.75 0 1 1 1.06-1.06l2.094 2.093 3.473-4.425a.267.267 0 0 1 .02-.022z"/></symbol><symbol id="clipboard" viewBox="0 0 16 16" fill="currentColor"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></symbol><symbol id="question-circle-fill" viewBox="0 0 16 16" fill="currentColor"><path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.496 6.033h.825c.138 0 .248-.113.266-.25.09-.656.54-1.134 1.342-1.134.686 0 1.314.343 1.314 1.168 0 .635-.374.927-.965 1.371-.673.489-1.206 1.06-1.168 1.987l.003.217a.25.25 0 0 0 .25.246h.811a.25.25 0 0 0 .25-.25v-.105c0-.718.273-.927 1.01-1.486.609-.463 1.244-.977 1.244-2.056 0-1.511-1.276-2.241-2.673-2.241-1.267 0-2.655.59-2.75 2.286a.237.237 0 0 0 .241.247zm2.325 6.443c.61 0 1.029-.394 1.029-.927 0-.552-.42-.94-1.029-.94-.584 0-1.009.388-1.009.94 0 .533.425.927 1.01.927z"/></symbol><symbol id="chevron-left" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/></symbol><symbol id="chevron-right" viewBox="0 0 16 16" fill="currentColor"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></symbol><symbol id="chat-left-dots" viewBox="0 0 16 16" fill="currentColor"><path d="M14 1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H4.414A2 2 0 0 0 3 11.586l-2 2V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12.793a.5.5 0 0 0 .854.353l2.853-2.853A1 1 0 0 1 4.414 12H14a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M5 6a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/></symbol></defs></svg><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/blog/"><strong>Blog</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent" style="flex-grow:0"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/blog/"><i class="iconfont icon-home-fill"></i> <span>Home</span></a></li><li class="nav-item"><a class="nav-link" href="/blog/archives"><i class="iconfont icon-archive-fill"></i> <span>Archives</span></a></li><li class="nav-item"><a class="nav-link" href="/blog/categories"><i class="iconfont icon-category-fill"></i> <span>Categories</span></a></li><li class="nav-item"><a class="nav-link" href="/blog/tags"><i class="iconfont icon-tags-fill"></i> <span>Tags</span></a></li><li class="nav-item"><a class="nav-link" href="/blog/about"><i class="iconfont icon-user-fill"></i> <span>About</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-bs-toggle="modal" data-bs-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/blog/img/js.webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="fs-1"><span id="subtitle" data-typed-text="高阶函数"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-05-08 20:18" pubdate>Monday, May 8, 2023 8:18 PM</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 8.5k words </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 71 mins</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><p class="alert alert-info">Last updated on Saturday, March 16, 2024 11:27 AM</p><div class="markdown-body"><h2 id="回调函数"><a href="#回调函数" class="headerlink" title="回调函数"></a>回调函数</h2><p>函数作为参数传递。</p><h3 id="异步请求"><a href="#异步请求" class="headerlink" title="异步请求"></a>异步请求</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> getUserInfo = <span class="hljs-keyword">function</span>(<span class="hljs-params">userId, callback</span>) &#123;<br>    $.<span class="hljs-title function_">ajax</span>(<span class="hljs-string">&#x27;http://xxx?&#x27;</span> + userId, <span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>            <span class="hljs-title function_">callback</span>(data);<br>        &#125;<br>    &#125;);<br>&#125;<br><br><span class="hljs-title function_">getUserInfo</span>(<span class="hljs-number">13157</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data.<span class="hljs-property">userName</span>);<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="“委托”"><a href="#“委托”" class="headerlink" title="“委托”"></a>“委托”</h3><div class="note alert alert-warning"><div><p>回调函数的应用不仅只是在异步请求中，当一个函数不适合执行一些请求时，可以把这些请求封装成一个函数，并把它作为参数传递给另外一个函数，“委托”给另外一个函数来执行。<br>隐藏节点的请求实际上是由客户发起，但是客户并不知道节点什么时候会创建好，于是把隐藏节点的逻辑放在回调函数中，“委托”给appendDiv方法，appendDiv方法当然知道节点什么时候创建好，所以在节点创建好的时候，appendDiv会执行之前客户传入的回调函数。</p></div></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> appendDiv = <span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) &#123;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>        <span class="hljs-keyword">var</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElemnt</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br>        div.<span class="hljs-property">innerHTML</span> = i;<br>        <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(div);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">&#x27;function&#x27;</span>) &#123;<br>            <span class="hljs-title function_">callback</span>(div);<br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-title function_">appendDiv</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">node</span>) &#123;<br>    node.<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">&#x27;none&#x27;</span>;<br>&#125;);<br></code></pre></td></tr></table></figure><h3 id="数组方法"><a href="#数组方法" class="headerlink" title="数组方法"></a>数组方法</h3><div class="note alert alert-success"><div><p>Array.prototype.sort的目的是对数组元素进行排序，这是不变的部分，具体用什么规则排序，是可变的部分，把可变的部分分装在函数参数里，动态传入Array.prototype.sort，使Array.prototype.sort方法成为一个非常灵活的方法</p></div></div><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 从小到大, [1,3,4]</span><br>[<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>].<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) &#123;<br>    <span class="hljs-keyword">return</span> a - b;<br>&#125;);<br><br><span class="hljs-comment">// 从大到小, [4,3,1]</span><br>[<span class="hljs-number">1</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>].<span class="hljs-title function_">sort</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) &#123;<br>    <span class="hljs-keyword">return</span> b - a;<br>&#125;);<br></code></pre></td></tr></table></figure><h2 id="函数作为返回值输出"><a href="#函数作为返回值输出" class="headerlink" title="函数作为返回值输出"></a>函数作为返回值输出</h2><p>相比把函数当做参数传递，函数当做返回值输出的应用场景更多，也更能体现函数式编程的巧妙。让函数继续返回一个可执行的函数，意味着运算过程是可延续的。</p><div class="note alert alert-info"><div><p>判断一个数据是否是数组，在以往的实现中，如果基于鸭子模型的概念来判断，就是判断这个数据有没有length属性，有没有sort或者slice方法等。但是更好的方式是用Object.prototype.toString返回的字符串来计算。</p></div></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> isType = <span class="hljs-keyword">function</span>(<span class="hljs-params">type</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(obj) === <span class="hljs-string">&#x27;[object &#x27;</span> + type + <span class="hljs-string">&#x27;]&#x27;</span>;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">var</span> isString = <span class="hljs-title function_">isType</span>(<span class="hljs-string">&#x27;String&#x27;</span>);<br><span class="hljs-keyword">var</span> isArray = <span class="hljs-title function_">isType</span>(<span class="hljs-string">&#x27;Array&#x27;</span>);<br><span class="hljs-keyword">var</span> isNumber = <span class="hljs-title function_">isType</span>(<span class="hljs-string">&#x27;Number&#x27;</span>);<br><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-title function_">isArray</span>([<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>])); <span class="hljs-comment">// true</span><br><br><span class="hljs-comment">// 还可以利用循环，来批量注册这些isType函数</span><br><span class="hljs-keyword">var</span> <span class="hljs-title class_">Type</span> = &#123;&#125;;<br><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, type; type = [<span class="hljs-string">&#x27;String&#x27;</span>, <span class="hljs-string">&#x27;Array&#x27;</span>, <span class="hljs-string">&#x27;Number&#x27;</span>][i++]; ) &#123;<br>    (<span class="hljs-keyword">function</span>(<span class="hljs-params">type</span>) &#123;<br>        <span class="hljs-title class_">Type</span>[<span class="hljs-string">&#x27;is&#x27;</span> + type] = <span class="hljs-keyword">function</span>(<span class="hljs-params">obj</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-title class_">Object</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">toString</span>.<span class="hljs-title function_">call</span>(obj) === <span class="hljs-string">&#x27;[object&#x27;</span> + type + <span class="hljs-string">&#x27;]&#x27;</span>;<br>        &#125;<br>    &#125;)(type)<br>&#125;;<br><br><span class="hljs-title class_">Type</span>.<span class="hljs-title function_">isArray</span>([]); <span class="hljs-comment">// true</span><br><span class="hljs-title class_">Type</span>.<span class="hljs-title function_">isString</span>(<span class="hljs-string">&#x27;&#x27;</span>); <span class="hljs-comment">// true</span><br><br></code></pre></td></tr></table></figure><h3 id="单例"><a href="#单例" class="headerlink" title="单例"></a>单例</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> getSingle = <span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) &#123;<br>    <span class="hljs-keyword">var</span> ret;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> ret || (ret = fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>));<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">var</span> getScript = <span class="hljs-title function_">getSingle</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;script&#x27;</span>);<br>&#125;);<br><br><span class="hljs-keyword">var</span> script1 = <span class="hljs-title function_">getScript</span>();<br><span class="hljs-keyword">var</span> script2 = <span class="hljs-title function_">getScript</span>();<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(script1 === script2); <span class="hljs-comment">// true</span><br></code></pre></td></tr></table></figure><h2 id="高阶函数实现AOP"><a href="#高阶函数实现AOP" class="headerlink" title="高阶函数实现AOP"></a>高阶函数实现AOP</h2><p><code>AOP</code>（面向切面编程）的主要作用是把一些跟核心业务逻辑模块无关的功能抽取出来，这些业务逻辑无关的功能通常包括日志统计、安全控制、异常处理等。把这些功能抽离出来之后，再通过”动态织入”的方式参入业务逻辑模块中。这样做的好处首先是保持业务逻辑模块的纯净和高内聚性，其次是可以很方便地复用日志统计等功能模块。</p><p>在<code>javascript</code>中实现<code>AOP</code>，都是把一个函数”动态织入”到另外一个函数中，例如</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">before</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">beforefn</span>) &#123;<br>    <span class="hljs-keyword">var</span> __self = <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 保存原函数的引用</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">// 保存包含了原函数和新函数的“代理”函数</span><br>        beforefn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>); <span class="hljs-comment">// 执行新函数，修正this</span><br>        <span class="hljs-keyword">return</span> __self.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>); <span class="hljs-comment">// 执行原函数</span><br>    &#125;<br>&#125;;<br><br><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">after</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params">afterfn</span>) &#123;<br>    <span class="hljs-keyword">var</span> __self = <span class="hljs-variable language_">this</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> ret = __selft.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);<br>        afterfn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">arguments</span>);<br>        <span class="hljs-keyword">return</span> ret;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">var</span> func = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;func&#x27;</span>);<br>&#125;;<br><br>func = func.<span class="hljs-title function_">before</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;before&#x27;</span>);<br>&#125;).<span class="hljs-title function_">after</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;after&#x27;</span>);<br>&#125;);<br><br><span class="hljs-title function_">func</span>();<br><span class="hljs-comment">// before</span><br><span class="hljs-comment">// func</span><br><span class="hljs-comment">// after</span><br></code></pre></td></tr></table></figure><h2 id="高阶函数的其它应用"><a href="#高阶函数的其它应用" class="headerlink" title="高阶函数的其它应用"></a>高阶函数的其它应用</h2><h3 id="currying-函数柯里化，部分求值"><a href="#currying-函数柯里化，部分求值" class="headerlink" title="currying 函数柯里化，部分求值"></a>currying 函数柯里化，部分求值</h3><p>一个<code>currying</code>函数首先会接收一些参数，该函数并不会立即求值，而是继续返回另外一个函数，刚才传入的参数在函数形成的闭包中被保存起来。等待函数被真正需要求值的时候，之前传入的所有参数都会一次性用于求值。<em>（利用已有的函数，再创建一个动态的函数，该动态函数内部还是通过已有的函数来发生作用，只是传入更多的参数来简化函数的参数方面调用）</em></p><h3 id="计算每月开销"><a href="#计算每月开销" class="headerlink" title="计算每月开销"></a>计算每月开销</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> monthlyCost = <span class="hljs-number">0</span>;<br><br><span class="hljs-keyword">var</span> cost = <span class="hljs-keyword">function</span>(<span class="hljs-params">money</span>) &#123;<br>    monthlyCost += money;<br>&#125;;<br><br><span class="hljs-title function_">cost</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">// 第一天100</span><br><span class="hljs-title function_">cost</span>(<span class="hljs-number">200</span>); <span class="hljs-comment">// 第二天200</span><br><span class="hljs-title function_">cost</span>(<span class="hljs-number">300</span>); <span class="hljs-comment">// 第三天300</span><br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(monthlyCost); <span class="hljs-comment">//三天花费600</span><br></code></pre></td></tr></table></figure><div class="note alert alert-warning"><div><p>上面代码可以看到，每天结束后都会记录并计算到今天为止花掉的钱，但事实上并不需要关心每天花掉多少钱，而只想知道月底一共花费了多少钱，实际上只要在月底计算一次。</p></div></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> cost = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> args = [];<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">var</span> money = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = args.<span class="hljs-property">length</span>; i &lt; l; i++) &#123;<br>                money += args[i];<br>            &#125;<br>            <span class="hljs-keyword">return</span> money;<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            [].<span class="hljs-property">push</span>.<span class="hljs-title function_">apply</span>(args, <span class="hljs-variable language_">arguments</span>);<br>        &#125;<br>    &#125;<br>&#125;)();<br><br><span class="hljs-title function_">cost</span>(<span class="hljs-number">100</span>); <span class="hljs-comment">// 未真正求值</span><br><span class="hljs-title function_">cost</span>(<span class="hljs-number">200</span>); <span class="hljs-comment">// 未真正求值</span><br><span class="hljs-title function_">cost</span>(<span class="hljs-number">300</span>); <span class="hljs-comment">// 未真正求值</span><br><span class="hljs-title function_">cost</span>(); <span class="hljs-comment">// 求值: 600</span><br></code></pre></td></tr></table></figure><div class="note alert alert-success"><div><p>再改进一下，编写一个通用的<code>currying</code>函数</p></div></div><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 接受并处理参数</span><br><span class="hljs-keyword">var</span> currying = <span class="hljs-keyword">function</span>(<span class="hljs-params">fn</span>) &#123;<br>    <span class="hljs-keyword">var</span> args = [];<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> fn.<span class="hljs-title function_">apply</span>(<span class="hljs-variable language_">this</span>, args);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            [].<span class="hljs-property">push</span>.<span class="hljs-title function_">apply</span>(args, <span class="hljs-variable language_">arguments</span>);<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">callee</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 计算总额</span><br><span class="hljs-keyword">var</span> costFn = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> money = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, l = <span class="hljs-variable language_">arguments</span>.<span class="hljs-property">length</span>; i &lt; l; i++) &#123;<br>            money += <span class="hljs-variable language_">arguments</span>[i];<br>        &#125;<br>        <span class="hljs-keyword">return</span> money;<br>    &#125;<br>&#125;)();<br><br><span class="hljs-keyword">var</span> cost = <span class="hljs-title function_">currying</span>(costFn); <span class="hljs-comment">// 转换成currying函数</span><br><span class="hljs-title function_">cost</span>(<span class="hljs-number">100</span>);<br><span class="hljs-title function_">cost</span>(<span class="hljs-number">200</span>);<br><span class="hljs-title function_">cost</span>(<span class="hljs-number">300</span>);<br><span class="hljs-title function_">cost</span>(); <span class="hljs-comment">// 600</span><br></code></pre></td></tr></table></figure><h3 id="uncurrying"><a href="#uncurrying" class="headerlink" title="uncurrying"></a>uncurrying</h3><p>把泛化<code>this</code>的过程提取出来</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">uncurrying</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> self = <span class="hljs-variable language_">this</span>; <span class="hljs-comment">// 当前函数</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> obj = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">shilft</span>.<span class="hljs-title function_">call</span>(<span class="hljs-variable language_">arguments</span>); <span class="hljs-comment">// 取第一个元素</span><br>        <span class="hljs-keyword">return</span> self.<span class="hljs-title function_">apply</span>(obj, <span class="hljs-variable language_">arguments</span>); <span class="hljs-comment">// 执行函数和参数</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">// 通过uncurrying的方式，把Array.prototype.push.call变成一个通用的push函数</span><br><span class="hljs-keyword">var</span> push = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">push</span>.<span class="hljs-title function_">uncurrying</span>();<br>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-title function_">push</span>(<span class="hljs-variable language_">arguments</span>, <span class="hljs-number">4</span>);<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">arguments</span>); <span class="hljs-comment">// [1,2,3,4]</span><br>&#125;)(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>);<br><br><span class="hljs-comment">// 同样，一次性地把Array.prototype上的方法&quot;复制&quot;到array对象上</span><br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, fn, ary = [<span class="hljs-string">&#x27;push&#x27;</span>, <span class="hljs-string">&#x27;shift&#x27;</span>, <span class="hljs-string">&#x27;forEach&#x27;</span>]; fn = ary[i++];) &#123;<br>    <span class="hljs-title class_">Array</span>[fn] = <span class="hljs-title class_">Array</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>[fn].<span class="hljs-title function_">uncurrying</span>();<br>&#125;<br><br><span class="hljs-comment">// 现在给出uncurrying另外一种实现方式</span><br><span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">uncurrying</span> = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> self = <span class="hljs-variable language_">this</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-title class_">Function</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>.<span class="hljs-property">call</span>.<span class="hljs-title function_">apply</span>(self, <span class="hljs-variable language_">arguments</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="函数节流"><a href="#函数节流" class="headerlink" title="函数节流"></a>函数节流</h2><p>在有些场景下，函数可能被很频繁地调用，而造成大的性能问题，比如<br>1、当浏览器窗口大小被拖动而改变的时候，<code>window.onresize</code>事件触发频率很高，有一些跟<code>DOM</code>节点相关的操作，而跟<code>DOM</code>节点相关的操作往往是非常消耗性能的，这时候浏览器可能就会吃不消造成卡顿现象<br>2、拖拽元素节点<code>mousemove</code><br>3、上传进度，浏览器插件在真正开始上传文件之前，会对文件进行扫描并随时通知<code>javascript</code>函数，以便在页面中显示当前的扫描进度，通知的频率非常高，大约一秒钟10次<br>4、输入框onkeyup, input, onkeydown</p><p>以上三个场景，共同问题是函数被触发的频率太高，事实上可以不需要那么每次都处理，只需要处理有效的次数即可，这里就需要用到函数节流了，下面<code>throttle</code>函数的原理是，将准备被执行的函数用<code>setTimeout</code>延迟一段时间执行，如果该次延迟执行还没有完成，则忽略接下来调用该函数的请求。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> throttle = <span class="hljs-keyword">function</span>(<span class="hljs-params">fn, interval</span>) &#123;<br>    <br>    <span class="hljs-keyword">var</span> __self = fn, <span class="hljs-comment">// 保存需要被延迟执行的函数引用</span><br>        timer, <span class="hljs-comment">// 定时器</span><br>        firstTime = <span class="hljs-literal">true</span>; <span class="hljs-comment">// 是否第一次调用</span><br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">var</span> args = <span class="hljs-variable language_">arguments</span>,<br>            __me = <span class="hljs-variable language_">this</span>;<br>        <br>        <span class="hljs-keyword">if</span>(firstTime) &#123; <span class="hljs-comment">// 如果是第一次调用，不需延迟执行</span><br>            __self.<span class="hljs-title function_">apply</span>(__me, args);<br>            <span class="hljs-keyword">return</span> firstTime = <span class="hljs-literal">false</span>;<br>        &#125;<br>        <br>        <span class="hljs-keyword">if</span>(timer) &#123; <span class="hljs-comment">// 如果定时器还在，说明前一次延迟还没有完成</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        &#125;<br>        <br>        timer = <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123; <span class="hljs-comment">// 延迟一段时间执行</span><br>            <span class="hljs-built_in">clearTimeout</span>(timer);<br>            timer = <span class="hljs-literal">null</span>;<br>            __self.<span class="hljs-title function_">apply</span>(__me, args);<br>        &#125;, interval || <span class="hljs-number">500</span>);<br>        <br>    &#125;<br>    <br>&#125;;<br><span class="hljs-variable language_">window</span>.<span class="hljs-property">onresize</span> = <span class="hljs-title function_">throttle</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);<br>&#125;, <span class="hljs-number">500</span>);<br></code></pre></td></tr></table></figure><h2 id="分时函数"><a href="#分时函数" class="headerlink" title="分时函数"></a>分时函数</h2><p>同时往页面添加大量DOM节点显然会让浏览器吃不消，往往就是浏览器卡顿，解决方案就是让将创建节点的工作分批进行，例如把1秒钟创建1000个节点，改为每隔200毫秒创建8个节点</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> timeChunk = <span class="hljs-keyword">function</span>(<span class="hljs-params">ary, fn, count</span>) &#123;<br>    <br>    <span class="hljs-keyword">var</span> obj,<br>        t;<br>    <br>    <span class="hljs-keyword">var</span> len = ary.<span class="hljs-property">length</span>;<br>    <br>    <span class="hljs-keyword">var</span> start = <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">min</span>(count || <span class="hljs-number">1</span>, ary.<span class="hljs-property">length</span>); i++) &#123;<br>            <span class="hljs-keyword">var</span> obj = ary.<span class="hljs-title function_">shift</span>();<br>            <span class="hljs-title function_">fn</span>(obj);<br>        &#125;<br>    &#125;;<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>        t = <span class="hljs-built_in">setInterval</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-keyword">if</span>(ary.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) &#123; <span class="hljs-comment">// 如果全部节点都已经被创建好</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-built_in">clearInterval</span>(t);<br>            &#125;<br>            <span class="hljs-title function_">start</span>();<br>        &#125;, <span class="hljs-number">200</span>); <span class="hljs-comment">// 分批执行的时间间隔，也可以用参数的形式传入</span><br>    &#125;;<br>    <br>&#125;;<br><br><span class="hljs-keyword">var</span> ary = [];<br><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">1000</span>; i++) &#123;<br>    ary.<span class="hljs-title function_">push</span>(i);<br>&#125;<br><br><span class="hljs-keyword">var</span> renderFriendList = <span class="hljs-title function_">timeChunk</span>(ary, <span class="hljs-keyword">function</span>(<span class="hljs-params">n</span>) &#123;<br>    <span class="hljs-keyword">var</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br>    div.<span class="hljs-property">innerHTML</span> = n;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(div);<br>&#125;, <span class="hljs-number">8</span>);<br><br><span class="hljs-title function_">renderFriendList</span>();<br></code></pre></td></tr></table></figure><h2 id="惰性加载函数"><a href="#惰性加载函数" class="headerlink" title="惰性加载函数"></a>惰性加载函数</h2><p>在web开发中，因为浏览器之间的差异，需要做兼容，比如个个浏览器中能工通用的时间绑定函数<code>addEvent</code></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-comment">// 缺点：每次调用的时候都会执行里面的if分支，虽然开销不大，但也许有一些方法可以让程序避免这些重复的执行过程</span><br><span class="hljs-keyword">var</span> addEvent = <span class="hljs-keyword">function</span>(<span class="hljs-params">elem, type, handler</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">addEventListener</span>) &#123;<br>        <span class="hljs-keyword">return</span> elem.<span class="hljs-title function_">addEventListener</span>(type, handler, <span class="hljs-literal">false</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">attachEvent</span>) &#123;<br>        <span class="hljs-keyword">return</span> elem.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">&#x27;on&#x27;</span> + type, handler);<br>    &#125;<br>&#125;;<br><br><span class="hljs-comment">// 在代码加载的时候立刻进行一次判断，让addEvent返回一个包裹了正确逻辑的函数；</span><br><span class="hljs-comment">// 缺点：从头到尾都没用使用过addEvent函数，这样看来，前一次的浏览器嗅探是完全多余的操作，</span><br><span class="hljs-comment">// 而且这也会稍稍延长页面ready时间</span><br><span class="hljs-keyword">var</span> addEvent = (<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">addEventListener</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">elem, type, handler</span>) &#123;<br>            elem.<span class="hljs-title function_">addEventListener</span>(type, handler, <span class="hljs-literal">false</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">window</span>.<span class="hljs-property">attachEvent</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">function</span>(<span class="hljs-params">elem, type, handler</span>) &#123;<br>            elem.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">&#x27;on&#x27;</span> + type, handler);<br>        &#125;<br>    &#125;<br>&#125;)();<br><br><span class="hljs-comment">// 惰性载入函数方案，addEvent被声明为一个普通函数，函数里也有分支判断，</span><br><span class="hljs-comment">// 但在第一次进入条件分支之后，函数内部会重写这个函数，重写之后的函数就是我们期待的addEvent函数，</span><br><span class="hljs-comment">// 在下一次进入addEvent函数的时候，addEvent已经不再存在条件分支语句</span><br><span class="hljs-keyword">var</span> addEvent = <span class="hljs-keyword">function</span>(<span class="hljs-params">elem, type, handler</span>) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">addEventListener</span>) &#123;<br>        addEvent = <span class="hljs-keyword">function</span>(<span class="hljs-params">elem, type, handler</span>) &#123;<br>            elem.<span class="hljs-title function_">addEventListener</span>(type, handler, <span class="hljs-literal">false</span>);<br>        &#125;<br>    &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">attachEvent</span>) &#123;<br>        addEvent = <span class="hljs-keyword">function</span>(<span class="hljs-params">elem, type, handler</span>) &#123;<br>            elem.<span class="hljs-title function_">attachEvent</span>(<span class="hljs-string">&#x27;on&#x27;</span> + type, handler);<br>        &#125;<br>    &#125;<br>    <br>    <span class="hljs-title function_">addEvent</span>(elem, type, handler);<br>&#125;;<br><br><span class="hljs-keyword">var</span> div = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&#x27;div&#x27;</span>);<br><span class="hljs-title function_">addEvent</span>(div, <span class="hljs-string">&#x27;click&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-number">1</span>);<br>&#125;);<br></code></pre></td></tr></table></figure></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/blog/categories/front-end/" class="category-chain-item">front-end</a> </span><span class="category-chain"><a href="/blog/categories/back-end/" class="category-chain-item">back-end</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/blog/tags/javascript/" class="print-no-link">#javascript</a></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/blog/2023/05/10/fe/browserslit/" title="browserslist"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">browserslist</span> <span class="visible-mobile">Previous</span></a></article><article class="post-next col-6"><a href="/blog/2023/05/07/nodejs/require/" title="require"><span class="hidden-mobile">require</span> <span class="visible-mobile">Next</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>Table of Contents</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="modalSearchLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">Search</h4><button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="modalSearchInput" class="form-control validate"> <label data-error="x" data-success="v" for="modalSearchInput">Keyword</label></div><div class="list-group" id="modalSearchResult"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="/blog/about" rel="nofollow noopener">blog <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-heart-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/></svg> 1.3.0</a></div></div></footer><link rel="stylesheet" href="//cdn.staticfile.net/nprogress/0.2.0/nprogress.min.css"><script src="//cdn.staticfile.net/nprogress/0.2.0/nprogress.min.js"></script><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="//cdn.staticfile.net/typed.js/2.1.0/typed.umd.min.js"></script><script src="//cdn.staticfile.net/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script><script src="/blog/js/local-search.js"></script><script src="/blog/js/events.js"></script><script>!function(t){var e=document.getElementById("subtitle");e&&"Typed"in t&&(e.innerText="",e=e.getAttribute("data-typed-text"),new t.Typed("#subtitle",{strings:["  ",e],cursorChar:"_",typeSpeed:80,loop:!1}))}(window)</script><script src="//cdn.staticfile.net/tocbot/4.25.0/tocbot.min.js"></script><script src="/blog/js/post/toc.js"></script><script src="//cdn.staticfile.net/clipboard.js/2.0.11/clipboard.min.js"></script><script src="/blog/js/post/copying-code.js"></script><link rel="stylesheet" href="//cdn.staticfile.net/photoswipe/5.4.2/photoswipe.min.css"><script type="module" src="/blog/js/post/img-swipe.js"></script><script type="module" src="/blog/js/post/enable.js"></script><noscript><div class="noscript-warning">LNote works best with JavaScript enabled</div></noscript></body></html>